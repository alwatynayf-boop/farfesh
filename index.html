<script>
    // --- الأكواد السابقة (لو خيروك، النكت، الرسام، باك مان) تبقى كما هي بدون تغيير ---
    
    // دالة التبديل
    function show(id) {
        var sections = document.getElementsByClassName('section');
        for (var i = 0; i < sections.length; i++) {
            sections[i].classList.remove('active-section');
        }
        document.getElementById(id).classList.add('active-section');
        if (id === 'paint-sec') setTimeout(initCanv, 100);
        if (id === 'pac-sec') initPacman(); else { if(typeof pacInt !== 'undefined') clearInterval(pacInt); pOn = false; }
    }

    const qs = [{a:"تطير بس تمشي بطيء جداً", b:"تختفي بس صوتك عالي وفاضحك"}, {a:"تاكل صرصور مقلي ومقرمش", b:"تشرب بنزين بارد مع ثلج"}, {a:"تكون عبقري بس فقير وشحات", b:"تكون غبي جداً بس عندك مليارات"}, {a:"ترجع للماضي وتغير كل أغلاطك", b:"تروح للمستقبل وتشوف وش بيصير لك"}, {a:"تكلم الحيوانات وتفهم عليهم", b:"تتحدث كل لغات البشر بطلاقة"}, {a:"تمشي حافي على رمل حارق", b:"تلبس جزمة ضيقة تعورك طول اليوم"}, {a:"تعيش في القطب المتجمد لحالك", b:"تعيش في وسط الصحراء بعز الصيف"}, {a:"تنام 20 ساعة وتصحى تعبان", b:"تنام ساعتين بس وتكون نشيط"}, {a:"تسمع أفكار الناس اللي حولك", b:"تتحكم في الوقت وتوقفه متى ما تبي"}, {a:"تعيش بدون إنترنت للأبد", b:"تعيش بدون مكيف في الظهرية"}];
    const js = ["محشش سألوه ايش اصعب شي بالحياة؟ قال انك تحدد السكسوكة وانت تاكل علك!", "غبي رمى جواله من البلكونة ولقاه مكسور.. قال غريبة مع اني حاطه وضع طيران!", "مدرس سأل طالب: الثعلب يولد ولا يبيض؟ قال: الثعلب مكار توقع منه أي شي!", "واحد سأل محشش: شو اسماء اخوانك؟ قال: كلهم محمد إلا خالد اسمه فيصل!", "محشش شاف إشارة ممنوع الوقوف.. قام انبطح بالشارع!", "بخيل احترق بيته، اتصل بالمطافي رنة وحدة وقفل عشان ما يصرف!"];
    let qI=0, jI=0;
    function nextQ(){ document.getElementById('q-blue').innerText=qs[qI].a; document.getElementById('q-red').innerText=qs[qI].b; qI=(qI+1)%qs.length; }
    function nextJ(){ document.getElementById('joke-box').innerText=js[jI]; jI=(jI+1)%js.length; }
    nextQ(); nextJ();

    // الرسام
    let canv=document.getElementById('canv'), ctx=canv.getContext('2d'), drawing=false, tool='pen', color='#000', history=[];
    function saveStep(){ if(history.length > 20) history.shift(); history.push(canv.toDataURL()); }
    function undo(){ if(history.length > 0){ let img = new Image(); img.src = history.pop(); img.onload = () => { ctx.clearRect(0,0,canv.width,canv.height); ctx.drawImage(img, 0, 0); } } }
    function initCanv(){ let box = canv.parentElement; canv.width=box.clientWidth; canv.height=box.clientHeight; ctx.lineCap='round'; ctx.lineJoin='round'; ctx.fillStyle="#fff"; ctx.fillRect(0,0,canv.width,canv.height); }
    function getPos(e){ let rect = canv.getBoundingClientRect(); let clientX = e.touches ? e.touches[0].clientX : e.clientX; let clientY = e.touches ? e.touches[0].clientY : e.clientY; return { x: clientX - rect.left, y: clientY - rect.top }; }
    function start(e){ drawing=true; saveStep(); let p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); }
    function draw(e){ if(!drawing) return; let p = getPos(e); ctx.strokeStyle = (tool=='eraser'?'#fff':color); ctx.lineWidth = document.getElementById('pw').value; ctx.lineTo(p.x, p.y); ctx.stroke(); }
    function stop(){ drawing=false; }
    canv.addEventListener('mousedown', start); canv.addEventListener('mousemove', draw); window.addEventListener('mouseup', stop);
    canv.addEventListener('touchstart', (e)=>{ e.preventDefault(); start(e); }); canv.addEventListener('touchmove', (e)=>{ e.preventDefault(); draw(e); }); canv.addEventListener('touchend', stop);
    function setTool(t){ tool=t; } function setCol(c){ color=c; tool='pen'; } 
    function fillCanvas(){ saveStep(); ctx.fillStyle = color; ctx.fillRect(0,0,canv.width,canv.height); }
    function clearC(){ saveStep(); ctx.fillStyle="#fff"; ctx.fillRect(0,0,canv.width,canv.height); }

    // --- تعديل المنتدى ليصبح أونلاين (سالم، هذا هو الجزء الجديد) ---
    // سنستخدم مكتبة بسيطة جداً للربط بين المستخدمين
    let userN = "";
    const CHANNEL_ID = 'sb2mN5057Gv0Xz9i'; // معرف مجاني مؤقت للدردشة
    let drone;

    function setName() {
        let n = document.getElementById('u-name').value;
        if (n) {
            userN = n;
            document.getElementById('name-setup').style.display = 'none';
            document.getElementById('chat-ui').style.display = 'flex';
            connectToChat();
        }
    }

    function connectToChat() {
        // إضافة مكتبة الدردشة خارجياً
        const script = document.createElement('script');
        script.src = 'https://cdn.scaledrone.com/scaledrone.min.js';
        script.onload = () => {
            drone = new ScaleDrone(CHANNEL_ID, { data: { name: userN } });
            drone.on('open', error => {
                if (error) return console.error(error);
                const room = drone.subscribe('observable-room');
                room.on('message', message => {
                    const {data, member} = message;
                    addMsg(member.clientData.name, data);
                });
            });
        };
        document.head.appendChild(script);
    }

    function postM() {
        let m = document.getElementById('f-msg').value;
        if (m && drone) {
            drone.publish({ room: 'observable-room', message: m });
            document.getElementById('f-msg').value = "";
        }
    }

    function addMsg(u, m) {
        let b = document.getElementById('forum-box');
        let color = (u === userN) ? "#00ff00" : "#00ffff"; // لونك أخضر وغيرك لبني
        b.innerHTML += `<div><b style="color:${color}">${u}:</b> ${m}</div>`;
        b.scrollTop = b.scrollHeight;
    }

    // باك مان (بدون تغيير)
    let pc=document.getElementById('pacman-canvas'), pctx=pc.getContext('2d'), pacInt;
    let px, py, pdir, score, pDots, pGhosts, pOn, pStep=35;
    function initPacman(){ document.getElementById('go-screen').style.display='none'; px=140; py=140; pdir='stop'; score=0; pOn=true; createDots(); pGhosts=[{x:20, y:20, c:'#f00', s:2.5}, {x:250, y:20, c:'#0ff', s:2.5}]; if(pacInt) clearInterval(pacInt); pacInt=setInterval(upPac, 40); }
    function setPacDir(d){ pdir=d; if(d=='up'||d=='down') px = Math.round((px-17)/pStep)*pStep+17; if(d=='left'||d=='right') py = Math.round((py-17)/pStep)*pStep+17; }
    function createDots(){ pDots=[]; for(let i=0; i<8; i++) for(let j=0; j<8; j++) pDots.push({x:i*pStep+17, y:j*pStep+17, a:true}); }
    function drawPixelPac(x,y){ pctx.fillStyle="yellow"; pctx.fillRect(x-8, y-8, 16, 16); pctx.fillStyle="black"; pctx.fillRect(x+2, y-4, 4, 4); pctx.clearRect(x, y-2, 8, 4); }
    function drawPixelGhost(x,y,c){ pctx.fillStyle=c; pctx.fillRect(x-8, y-6, 16, 12); pctx.fillRect(x-8, y+6, 4, 4); pctx.fillRect(x, y+6, 4, 4); pctx.fillRect(x+4, y+6, 4, 4); pctx.fillStyle="white"; pctx.fillRect(x-5, y-3, 4, 4); pctx.fillRect(x+2, y-3, 4, 4); }
    function upPac(){ if(!pOn) return; pctx.fillStyle="#000"; pctx.fillRect(0,0,280,280); if(pdir=='right') px+=4; if(pdir=='left') px-=4; if(pdir=='up') py-=4; if(pdir=='down') py+=4; if(px>280) px=0; if(px<0) px=280; if(py>280) py=0; if(py<0) py=280; drawPixelPac(px,py); pGhosts.forEach(g=>{ if(g.x<px) g.x+=g.s; else g.x-=g.s; if(g.y<py) g.y+=g.s; else g.y-=g.s; drawPixelGhost(g.x, g.y, g.c); if(Math.hypot(g.x-px, g.y-py)<15){ pOn=false; document.getElementById('go-screen').style.display='flex'; } }); pDots.forEach(d=>{ if(d.a){ pctx.fillStyle="#fff"; pctx.fillRect(d.x-2, d.y-2, 4, 4); if(Math.hypot(d.x-px, d.y-py)<14){ d.a=false; score+=10; } } }); document.getElementById('pac-score').innerText=score; if(pDots.every(d=>!d.a)) createDots(); }
                                                                           </script>
                                                                           
